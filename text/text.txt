const CourseResourceModel = require('../Model/CourseResourseModel');

const BatchModel = require('../Model/BatchModel');

const addResourse = async (req,res) =>{

      const data = req.body ;

      const {courseCode,resourseTitle,resourseDescription,resoursefile,email } = data;
      const existigResourse = await CourseResourceModel.findOne({where :{resoursefile :resoursefile}})
       
     if(!courseCode || !resourseTitle || !resourseDescription || ! resoursefile  )
     {
        return res.status(400).json({ message: "Bad Request: Missing Any Field " });
     }

     if(existigResourse)
      {
         return res.status(402).json({message: "Already Post This Resourse"})
      }

       

     try {
       
        const cr = await BatchModel.findOne({where: {email: email}})
       
        if(!cr)
        {
            return res.status(401).json({ message: "Unauthorized: You must be logged in as a Class Representative", data: null });
        }
        else {
            const resourse = await CourseResourceModel.create({
              courseCode,
              resourseTitle,
              resourseDescription,
              resoursefile
            })
            return res.status(201).json({'data':resourse, message :"Course resource posted successfully"})
        }
       
         


     }
     catch(error){
        return res.status(500).json({ error: "Internal Server Error" });
     }
     

}

module.exports = addResourse ;   






const courseResourceTestCases = [
   








  
    
    
    // // Test Case 4: Database Failure While Saving Resource
    // {
    //   id: 4,
    //   description: "Database failure while saving resource",
    //   mock: {
    //     findOne: { result: { id: "user-id", role: "class-representative" } },
    //     validate: { result: { registerEmail: "cruser@example.com", loginCode: "ValidLoginCode" } },
    //     save: { result: Promise.reject(new Error("Database error")) }
    //   },
    //   input: { 
    //     courseCode: "CS101", 
    //     resourceTitle: "Lecture Slides on Algorithms", 
    //     resourceDescription: "Slides covering basic sorting algorithms", 
    //     fileUpload: "algorithm_slides.pdf" 
    //   },
    //   expected: {
    //     status: 500,
    //     response: {
    //       message: "Failed to post course resources. Please try again later"
    //     }
    //   }
    // },
    
  // 
    
   // {
    //   id: 5,
    //   description: "Database failure while saving resource",
    //   mock: {
    //     findOne: { result: { id: "user-id", role: "class-representative" } },
    //     validate: { result: { registerEmail: "cruser@example.com", loginCode: "ValidLoginCode" } },
    //     save: { result: Promise.reject(new Error("Database error")) }
    //   },
    //   input: { 
    //     courseCode: "CS101", 
    //     resourceTitle: "Lecture Slides on Algorithms", 
    //     resourceDescription: "Slides covering basic sorting algorithms", 
    //     fileUpload: "algorithm_slides.pdf" 
    //   },
    //   expected: {
    //     status: 500,
    //     response: {
    //       message: "Failed to post course resources. Please try again later"
    //     }
    //  }
    // }, 
 
    

    
   
  ];
  
 module.exports = courseResourceTestCases ;